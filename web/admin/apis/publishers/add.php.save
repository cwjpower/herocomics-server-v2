<?php

header('Content-Type: application/json; charset=utf-8');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type, Authorization');

// OPTIONS preflight ìš”ì²­ ì²˜ë¦¬
if ($_SERVER['REQUEST_METHOD'] === 'OPTIONS') {
    http_response_code(200);
    exit;
}

if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    echo json_encode(['code' => 1, 'msg' => 'POST ìš”ì²­ë§Œ í—ˆìš©ë©ë‹ˆë‹¤.'], JSON_UNESCAPED_UNICODE);
    exit;
}
3. update_status.php ìˆ˜ì •
bash
nano ~/herocomics-server/web/admin/apis/publishers/update_status.php
ë§¨ ìœ„ í—¤ë”ë¥¼ ì´ë ‡ê²Œ êµì²´:

php
<?php
header('Content-Type: application/json; charset=utf-8');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type, Authorization');

// OPTIONS preflight ìš”ì²­ ì²˜ë¦¬
if ($_SERVER['REQUEST_METHOD'] === 'OPTIONS') {
    http_response_code(200);
    exit;
}

if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    echo json_encode(['code' => 1, 'msg' => 'POST ìš”ì²­ë§Œ í—ˆìš©ë©ë‹ˆë‹¤.'], JSON_UNESCAPED_UNICODE);
    exit;
}
âœ… ì €ì¥í•˜ê³  í…ŒìŠ¤íŠ¸!

í˜•, 3ê°œ íŒŒì¼ í—¤ë” ë¶€ë¶„ë§Œ ìˆ˜ì •í•˜ê³  ì•± ìƒˆë¡œê³ ì¹¨í•´ë´!

ì´ì œ CORS ì—ëŸ¬ ì‚¬ë¼ì§€ê³  ì¶œíŒì‚¬ ëª©ë¡ ë‚˜ì˜¬ ê±°ì•¼! ğŸš€




if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    echo json_encode(['code' => 1, 'msg' => 'POST ìš”ì²­ë§Œ í—ˆìš©ë©ë‹ˆë‹¤.'], JSON_UNESCAPED_UNICODE);
    exit;
}

$db_host = 'herocomics-mariadb';
$db_name = 'herocomics';
$db_user = 'root';
$db_pass = 'rootpass';

try {
    $pdo = new PDO(
        "mysql:host={$db_host};dbname={$db_name};charset=utf8mb4",
        $db_user,
        $db_pass,
        [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]
    );

    $publisher_name = $_POST['publisher_name'] ?? '';
    $publisher_code = $_POST['publisher_code'] ?? '';

    if (empty($publisher_name)) {
        echo json_encode(['code' => 1, 'msg' => 'ì¶œíŒì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'], JSON_UNESCAPED_UNICODE);
        exit;
    }

    if (empty($publisher_code)) {
        echo json_encode(['code' => 1, 'msg' => 'ì¶œíŒì‚¬ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'], JSON_UNESCAPED_UNICODE);
        exit;
    }

    $check = $pdo->prepare("SELECT publisher_id FROM bt_publishers WHERE publisher_code = ?");
    $check->execute([$publisher_code]);
    
    if ($check->fetch()) {
        echo json_encode(['code' => 1, 'msg' => 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì¶œíŒì‚¬ ì½”ë“œì…ë‹ˆë‹¤.'], JSON_UNESCAPED_UNICODE);
        exit;
    }

    $stmt = $pdo->prepare("
        INSERT INTO bt_publishers 
        (publisher_name, publisher_code, status, created_at)
        VALUES (?, ?, 'active', NOW())
    ");

    $stmt->execute([
        $publisher_name,
        strtoupper($publisher_code)
    ]);

    $publisher_id = $pdo->lastInsertId();

    echo json_encode([
        'code' => 0,
        'msg' => 'ì¶œíŒì‚¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.',
        'data' => [
            'publisher_id' => $publisher_id,
            'publisher_name' => $publisher_name,
            'publisher_code' => strtoupper($publisher_code)
        ]
    ], JSON_UNESCAPED_UNICODE);

} catch (PDOException $e) {
    echo json_encode([
        'code' => 1,
        'msg' => 'DB ì˜¤ë¥˜: ' . $e->getMessage()
    ], JSON_UNESCAPED_UNICODE);
}
?>
